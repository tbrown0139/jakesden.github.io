<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" /><title>ConsoleKit2-1.0.2</title><link rel="stylesheet" href="stylesheets/lfs.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="stylesheet" href="../stylesheets/lfs-print.css" type="text/css" media="print" /></head><body class="blfs" id="blfs-2017-01-20"><div class="navheader"><h4>Beyond Linux<sup>®</sup> From Scratch - Version 2017-01-20</h4><h3>Chapter 1. Installing packages in dependency build order</h3><ul><li class="prev"><a accesskey="p" href="pm-utils.html" title="pm-utils-1.4.1">Prev</a><p>pm-utils-1.4.1</p></li><li class="next"><a accesskey="n" href="dhcpcd.html" title="dhcpcd-6.11.5">Next</a><p>dhcpcd-6.11.5</p></li><li class="up"><a accesskey="u" href="ch01.html" title="Chapter 1. Installing packages in dependency build order">Up</a></li><li class="home"><a accesskey="h" href="index.html" title="Beyond Linux® From Scratch - Version 2017-01-20">Home</a></li></ul></div><div class="sect1" lang="en" xml:lang="en"><h1 class="sect1"><a id="consolekit" name="consolekit"></a>ConsoleKit2-1.0.2</h1><div class="package" lang="en" xml:lang="en"><h2 class="sect2">Introduction to ConsoleKit</h2><p>
      The <span class="application">ConsoleKit</span> package is a framework for
      keeping track of the various users, sessions, and seats present on a system.
      It provides a mechanism for software to react to changes of any of these
      items or of any of the metadata associated with them.
    </p><p>This package is known to build and work
                              properly using an LFS-7.10 platform.</p><h3>Package Information</h3><div class="itemizedlist"><ul class="compact"><li><p>
          Download (HTTP): <a class="ulink" href="https://github.com/Consolekit2/ConsoleKit2/releases/download/1.0.2/ConsoleKit2-1.0.2.tar.bz2">https://github.com/Consolekit2/ConsoleKit2/releases/download/1.0.2/ConsoleKit2-1.0.2.tar.bz2</a>
        </p></li><li></li><li><p>
          Download MD5 sum: e03dd98322c78425a87418af9d788518
        </p></li><li><p>
          Download size: 612 KB
        </p></li><li><p>
          Estimated disk space required: 11 MB
        </p></li><li><p>
          Estimated build time: 0.2 SBU
        </p></li></ul></div><h3>ConsoleKit Dependencies</h3><h4>Required</h4><p class="required">
      <a class="xref" href="dbus-glib.html" title="dbus-glib-0.108">dbus-glib-0.108</a> and
      xorg7-lib (in full book)
              
    </p><h4>Recommended</h4><p class="recommended">
      <a class="xref" href="linux-pam.html" title="Linux-PAM-1.3.0">Linux-PAM-1.3.0</a>,
      <a class="xref" href="polkit.html" title="Polkit-0.113">Polkit-0.113</a>, and
      <a class="xref" href="pm-utils.html" title="pm-utils-1.4.1">pm-utils-1.4.1</a> (run-time dependency to allow ConsoleKit2 to
      put the system in &#8220;<span class="quote">Suspend</span>&#8221; or &#8220;<span class="quote">Hibernation</span>&#8221;
      mode)
    </p><div class="admon warning"><img alt="[Warning]" src="images/warning.png" /><h3>Warning</h3><p>
        If you intend <span class="strong"><strong>NOT</strong></span> to install
        <span class="application">polkit</span>, you will need to manually edit the
        ConsoleKit.conf file to lock down the service. Failure to do so may be a
        huge SECURITY HOLE.
      </p></div><h4>Optional</h4><p class="optional">
      <a class="xref" href="xmlto.html" title="xmlto-0.0.28">xmlto-0.0.28</a>
    </p><p class="usernotes">User Notes:
      <a class="ulink" href="http://wiki.linuxfromscratch.org/blfs/wiki/consolekit">http://wiki.linuxfromscratch.org/blfs/wiki/consolekit</a>
    </p></div><div class="installation" lang="en" xml:lang="en"><h2 class="sect2">Installation of ConsoleKit</h2><p>
      Install <span class="application">ConsoleKit</span> by running the following
      commands:
    </p><pre class="userinput"><kbd class="command">./configure --prefix=/usr        \
            --sysconfdir=/etc    \
            --localstatedir=/var \
            --enable-udev-acl    \
            --enable-pam-module  \
            --enable-polkit      \
            --with-xinitrc-dir=/etc/X11/app-defaults/xinitrc.d \
            --docdir=/usr/share/doc/ConsoleKit-1.0.2           \
            --with-systemdsystemunitdir=no                     &amp;&amp;
make</kbd></pre><p>
      This package does not come with a test suite.
    </p><p>
      Now, as the <code class="systemitem">root</code> user:
    </p><pre class="root"><kbd class="command">make install &amp;&amp;

mv -v /etc/X11/app-defaults/xinitrc.d/90-consolekit{,.sh}</kbd></pre></div><div class="commands" lang="en" xml:lang="en"><h2 class="sect2">Command Explanations</h2><p>
      <em class="parameter"><code>--enable-udev-acl</code></em>: This switch enables building of
      the <span class="command"><strong>udev-acl</strong></span> tool, which is used to allow normal users
      to access device nodes normally only accessible to
      <code class="systemitem">root</code>.
    </p><p>
      <em class="parameter"><code>--enable-pam-module</code></em>: This switch enables building
      of the <span class="application">ConsoleKit</span>
      <span class="application">PAM</span> module which is needed for
      <span class="application">ConsoleKit</span> to work correctly with
      <span class="application">PAM</span>. Remove if
      <span class="application">Linux PAM</span> is
      <span class="strong"><strong>NOT</strong></span> installed.
    </p><p>
      <em class="parameter"><code>--enable-polkit</code></em>: Enable PolicyKit support.
    </p><p>
      <em class="parameter"><code>--with-xinitrc-dir=/etc/X11/app-defaults/xinitrc.d</code></em>:
      Fix the location of the 90-consolekit.sh script. Notice that the script
      has been renamed after installation, because xinitrc only sources script
      names ending with extension <span class="emphasis"><em>.sh</em></span>.
    </p><p>
      <em class="parameter"><code>--with-systemdsystemunitdir=no</code></em>: Disable
      attempting to build with systemd libraries.
    </p><p>
      <code class="option">--enable-docbook-docs</code>: Use this switch if
      <span class="application">xmlto</span> is installed and you wish to
      build the user and API documentation.
    </p></div><div class="configuration" lang="en" xml:lang="en"><h2 class="sect2">Configuring ConsoleKit</h2><div class="sect3" lang="en" xml:lang="en"><h3 class="sect3">PAM Module Configuration</h3><p>
        If you use <span class="application">Linux PAM</span>, it needs to be
        configured to activate <span class="application">ConsoleKit</span> upon user
        login.  This can be achieved by editing the
        <code class="filename">/etc/pam.d/system-session</code> file as the <code class="systemitem">root</code> user:
      </p><pre class="root"><kbd class="command">cat &gt;&gt; /etc/pam.d/system-session &lt;&lt; "EOF"
<code class="literal"># Begin ConsoleKit addition

session   optional    pam_loginuid.so
session   optional    pam_ck_connector.so nox11

# End ConsoleKit addition</code>
EOF</kbd></pre><p>
        You will also need a helper script that creates a file in
        <code class="filename">/var/run/console</code>
        named as the currently logged in user and that contains the
        <span class="application">D-Bus</span> address of the session. You
        can create the script by running the following commands as
        the <code class="systemitem">root</code> user:
      </p><pre class="root"><kbd class="command">cat &gt; /usr/lib/ConsoleKit/run-session.d/pam-foreground-compat.ck &lt;&lt; "EOF"
#!/bin/sh
TAGDIR=/var/run/console

[ -n "$CK_SESSION_USER_UID" ] || exit 1
[ "$CK_SESSION_IS_LOCAL" = "true" ] || exit 0

TAGFILE="$TAGDIR/`getent passwd $CK_SESSION_USER_UID | cut -f 1 -d:`"

if [ "$1" = "session_added" ]; then
    mkdir -p "$TAGDIR"
    echo "$CK_SESSION_ID" &gt;&gt; "$TAGFILE"
fi

if [ "$1" = "session_removed" ] &amp;&amp; [ -e "$TAGFILE" ]; then
    sed -i "\%^$CK_SESSION_ID\$%d" "$TAGFILE"
    [ -s "$TAGFILE" ] || rm -f "$TAGFILE"
fi
EOF
chmod -v 755 /usr/lib/ConsoleKit/run-session.d/pam-foreground-compat.ck</kbd></pre><p>
        See /usr/share/doc/ConsoleKit/spec/ConsoleKit.html for more
        configuration.
      </p></div></div><div class="content" lang="en" xml:lang="en"><h2 class="sect2">Contents</h2><div class="segmentedlist"><div class="seglistitem"><div class="seg"><strong class="segtitle">Installed Programs: </strong><span class="segbody">
          ck-history, ck-launch-session, ck-list-sessions,
          ck-log-system-restart, ck-log-system-start,
          ck-log-system-stop and console-kit-daemon
        </span></div><div class="seg"><strong class="segtitle">Installed Libraries: </strong><span class="segbody">
          libck-connector.so and pam_ck_connector.so
        </span></div><div class="seg"><strong class="segtitle">Installed Directories: </strong><span class="segbody">
          /etc/ConsoleKit,
          /usr/{include,lib}/ConsoleKit,
          /usr/share/doc/ConsoleKit-1.0.2, and
          /var/{log,run}/ConsoleKit
        </span></div></div></div><div class="variablelist"><h3>Short Descriptions</h3><table border="0"><col align="left" valign="top" /><tbody><tr><td><p><a id="ck-history"></a><span class="term"><span class="command"><strong>ck-history</strong></span></span></p></td><td><p>is a utility that provides information from the ConsoleKit
                database about what users have logged into the system.</p></td></tr><tr><td><p><a id="ck-launch-session"></a><span class="term"><span class="command"><strong>ck-launch-session</strong></span></span></p></td><td><p>is a utility for starting a command in its own ConsoleKit
                session.
          </p></td></tr><tr><td><p><a id="ck-list-sessions"></a><span class="term"><span class="command"><strong>ck-list-sessions</strong></span></span></p></td><td><p>list sessions with respective properties. Also good for
          debugging purposes.</p></td></tr><tr><td><p><a id="ck-log-system-restart"></a><span class="term"><span class="command"><strong>ck-log-system-restart</strong></span></span></p></td><td><p>write system restart to log.</p></td></tr><tr><td><p><a id="ck-log-system-start"></a><span class="term"><span class="command"><strong>ck-log-system-start</strong></span></span></p></td><td><p>write system start to log.</p></td></tr><tr><td><p><a id="ck-log-system-stop"></a><span class="term"><span class="command"><strong>ck-log-system-stop</strong></span></span></p></td><td><p>write system stop to log.</p></td></tr><tr><td><p><a id="console-kit-daemon"></a><span class="term"><span class="command"><strong>console-kit-daemon</strong></span></span></p></td><td><p>is the <span class="application">ConsoleKit</span> daemon.</p></td></tr></tbody></table></div></div><p class="updated">Last updated 
      on
       2016-08-27 20:19:14 +0000</p></div><div class="navfooter"><ul><li class="prev"><a accesskey="p" href="pm-utils.html" title="pm-utils-1.4.1">Prev</a><p>pm-utils-1.4.1</p></li><li class="next"><a accesskey="n" href="dhcpcd.html" title="dhcpcd-6.11.5">Next</a><p>dhcpcd-6.11.5</p></li><li class="up"><a accesskey="u" href="ch01.html" title="Chapter 1. Installing packages in dependency build order">Up</a></li><li class="home"><a accesskey="h" href="index.html" title="Beyond Linux® From Scratch - Version 2017-01-20">Home</a></li></ul></div></body></html>